<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì–¸ë¡ ì‚¬ ì·¨ì—… ìŠ¤í„°ë”” ë§¤ì¹­</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(45deg, #2c3e50, #3498db);
      color: white;
      text-align: center;
      padding: 30px 20px;
    }
    .header h1 { font-size: 2.2rem; margin-bottom: 10px; font-weight: 700; }
    .header p { font-size: 1.1rem; opacity: 0.9; }
    .content { padding: 30px; }
    .section {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 25px;
      border-left: 4px solid #3498db;
    }
    .section h2 { color: #2c3e50; margin-bottom: 15px; font-size: 1.5rem; }
    .form-group { margin-bottom: 15px; }
    .form-group label {
      display: block; margin-bottom: 5px; font-weight: 600; color: #555;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px;
      font-size: 14px; transition: border-color 0.3s;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none; border-color: #3498db;
    }
    .form-group textarea { resize: vertical; min-height: 80px; }
    .checkbox-group {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px; margin-top: 5px;
    }
    .checkbox-item { display: flex; align-items: center; }
    .checkbox-item input[type="checkbox"] {
      width: auto; margin-right: 8px; transform: scale(1.2);
    }
    .btn {
      background: linear-gradient(45deg, #3498db, #2980b9); color: white;
      padding: 12px 25px; border: none; border-radius: 8px; font-size: 16px;
      font-weight: 600; cursor: pointer; transition: all 0.3s;
      display: inline-block; text-decoration: none;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(52,152,219,0.4); }
    .btn-danger { background: linear-gradient(45deg, #e74c3c, #c0392b); }
    .btn-danger:hover { box-shadow: 0 5px 15px rgba(231,76,60,0.4); }
    .btn-success { background: linear-gradient(45deg, #27ae60, #229954); }
    .btn-success:hover { box-shadow: 0 5px 15px rgba(39,174,96,0.4); }
    .search-controls {
      display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: end;
    }
    .results { margin-top: 20px; padding: 15px; background: white;
      border-radius: 8px; border: 1px solid #e1e8ed; }
    .user-card {
      background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px;
      border-left: 4px solid #3498db;
    }
    .notice {
      background: #fff3cd; color: #856404; padding: 12px; border-radius: 6px;
      margin-bottom: 15px; border: 1px solid #ffeaa7;
    }
    .alert {
      padding: 15px; border-radius: 8px; margin-bottom: 15px; font-weight: 500;
    }
    .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .hidden { display: none !important; }
    .tabs { display: flex; border-bottom: 2px solid #e1e8ed; margin-bottom: 20px; }
    .tab {
      padding: 12px 20px; background: none; border: none; color: #666;
      font-size: 16px; cursor: pointer; border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }
    .tab.active { color: #3498db; border-bottom-color: #3498db; }
    .tab:hover { color: #3498db; }
    .loading { display: none; text-align: center; padding: 20px; }
    .loading.show { display: block; }
    @media (max-width: 600px) {
      .search-controls { grid-template-columns: 1fr; }
      .checkbox-group { grid-template-columns: 1fr; }
      .tabs { flex-wrap: wrap; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“° ì–¸ë¡ ì‚¬ ì·¨ì—… ìŠ¤í„°ë”” ë§¤ì¹­</h1>
      <p>ì–¸ë¡ ì‚¬ ì·¨ì—…ì„ ì¤€ë¹„í•˜ëŠ” í•™ìƒë“¤ì„ ìœ„í•œ ìŠ¤í„°ë”” êµ¬ì„± í”Œë«í¼</p>
    </div>
    <div class="content">
      <div id="alertDiv"></div>
      <div id="loading" class="loading"><p>ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p></div>

      <!-- ë¡œê·¸ì¸ ì „ -->
      <div id="guestSection">
        <div class="tabs">
          <button class="tab active" onclick="showTab('register')">íšŒì› ë“±ë¡</button>
          <button class="tab" onclick="showTab('login')">ë¡œê·¸ì¸</button>
        </div>

        <!-- íšŒì› ë“±ë¡ -->
        <div id="registerTab" class="section">
          <h2>ğŸ“ íšŒì› ë“±ë¡</h2>
          <div class="notice">
            í•™ë²ˆ, ë¹„ë°€ë²ˆí˜¸, ì´ë¦„, ì´ë©”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.
          </div>
          <form id="registerForm">
            <div class="form-group"><label>í•™ë²ˆ *</label><input type="text" id="studentId" required></div>
            <div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸ *</label><input type="password" id="password" required></div>
            <div class="form-group"><label>ì´ë¦„ *</label><input type="text" id="name" required></div>
            <div class="form-group"><label>ì´ë©”ì¼ *</label><input type="email" id="email" required></div>
            <div class="form-group"><label>íœ´ëŒ€í°</label><input type="text" id="phone"></div>
            <div class="form-group"><label>ì „ê³µ</label><input type="text" id="major"></div>
            <div class="form-group">
              <label>í¬ë§ ì§ì¢…</label>
              <div class="checkbox-group">
                <label><input type="checkbox" value="ê¸°ì"> ê¸°ì</label>
                <label><input type="checkbox" value="ì‹œì‚¬êµì–‘PD"> ì‹œì‚¬êµì–‘PD</label>
                <label><input type="checkbox" value="ì˜ˆëŠ¥PD"> ì˜ˆëŠ¥PD</label>
                <label><input type="checkbox" value="ë“œë¼ë§ˆPD"> ë“œë¼ë§ˆPD</label>
              </div>
            </div>
            <div class="form-group">
              <label>ìŠ¤í„°ë”” ë‹¨ê³„</label>
              <div class="checkbox-group">
                <label><input type="checkbox" value="ìŠ¤í„°ë””ì´ˆë³´ì"> ìŠ¤í„°ë””ì´ˆë³´ì</label>
                <label><input type="checkbox" value="ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬"> ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬</label>
                <label><input type="checkbox" value="ì¸í„°ë·°ì¤‘ì‹¬"> ì¸í„°ë·°ì¤‘ì‹¬</label>
                <label><input type="checkbox" value="ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ"> ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ</label>
              </div>
            </div>
            <div class="form-group">
              <label>ë‚¨ê¸°ê³  ì‹¶ì€ ê¸€</label>
              <textarea id="message"></textarea>
            </div>
            <button type="submit" class="btn">ë“±ë¡í•˜ê¸°</button>
          </form>
        </div>

        <!-- ë¡œê·¸ì¸ -->
        <div id="loginTab" class="section hidden">
          <h2>ğŸ” ë¡œê·¸ì¸</h2>
          <form id="loginForm">
            <div class="form-group"><label>í•™ë²ˆ</label><input type="text" id="loginStudentId" required></div>
            <div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="loginPassword" required></div>
            <button type="submit" class="btn">ë¡œê·¸ì¸</button>
          </form>
        </div>
      </div>

      <!-- ë¡œê·¸ì¸ í›„ -->
      <div id="userSection" class="hidden">
        <div class="section" style="background:#e8f5e8;">
          <h2>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, <span id="userName"></span>ë‹˜!</h2>
          <button onclick="logout()" class="btn" style="float:right;">ë¡œê·¸ì•„ì›ƒ</button>
          <div style="clear:both;"></div>
        </div>

        <div class="tabs">
          <button class="tab active" onclick="showUserTab('search')">ìŠ¤í„°ë””ì› ê²€ìƒ‰</button>
          <button class="tab" onclick="showUserTab('update')">ì •ë³´ ìˆ˜ì •</button>
        </div>

        <!-- ê²€ìƒ‰ -->
        <div id="searchTab" class="section">
          <h2>ğŸ” ìŠ¤í„°ë””ì› ê²€ìƒ‰</h2>
          <div class="search-controls">
            <div class="form-group">
              <label>í¬ë§ ì§ì¢…</label>
              <select id="searchJob">
                <option value="ê¸°ì">ê¸°ì</option>
                <option value="ì‹œì‚¬êµì–‘PD">ì‹œì‚¬êµì–‘PD</option>
                <option value="ì˜ˆëŠ¥PD">ì˜ˆëŠ¥PD</option>
                <option value="ë“œë¼ë§ˆPD">ë“œë¼ë§ˆPD</option>
              </select>
            </div>
            <div class="form-group">
              <label>ìŠ¤í„°ë”” ë‹¨ê³„</label>
              <select id="searchStage">
                <option value="ìŠ¤í„°ë””ì´ˆë³´ì">ìŠ¤í„°ë””ì´ˆë³´ì</option>
                <option value="ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬">ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬</option>
                <option value="ì¸í„°ë·°ì¤‘ì‹¬">ì¸í„°ë·°ì¤‘ì‹¬</option>
                <option value="ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ">ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ</option>
              </select>
            </div>
            <button onclick="search()" class="btn">ê²€ìƒ‰</button>
          </div>
          <div id="results" class="results hidden"></div>
        </div>

        <!-- ì •ë³´ ìˆ˜ì • -->
        <div id="updateTab" class="section hidden">
          <h2>âœï¸ ì •ë³´ ìˆ˜ì •</h2>
          <form id="updateForm">
            <div class="form-group"><label>ì „ê³µ</label><input type="text" id="updateMajor"></div>
            <div class="form-group"><label>í¬ë§ ì§ì¢…</label>
              <div class="checkbox-group" id="updateJobs">
                <label><input type="checkbox" value="ê¸°ì"> ê¸°ì</label>
                <label><input type="checkbox" value="ì‹œì‚¬êµì–‘PD"> ì‹œì‚¬êµì–‘PD</label>
                <label><input type="checkbox" value="ì˜ˆëŠ¥PD"> ì˜ˆëŠ¥PD</label>
                <label><input type="checkbox" value="ë“œë¼ë§ˆPD"> ë“œë¼ë§ˆPD</label>
              </div>
            </div>
            <div class="form-group"><label>ìŠ¤í„°ë”” ë‹¨ê³„</label>
              <div class="checkbox-group" id="updateStages">
                <label><input type="checkbox" value="ìŠ¤í„°ë””ì´ˆë³´ì"> ìŠ¤í„°ë””ì´ˆë³´ì</label>
                <label><input type="checkbox" value="ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬"> ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬</label>
                <label><input type="checkbox" value="ì¸í„°ë·°ì¤‘ì‹¬"> ì¸í„°ë·°ì¤‘ì‹¬</label>
                <label><input type="checkbox" value="ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ"> ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ</label>
              </div>
            </div>
            <div class="form-group"><label>ë‚¨ê¸°ê³  ì‹¶ì€ ê¸€</label>
              <textarea id="updateMessage"></textarea></div>
            <button type="submit" class="btn btn-success">ì •ë³´ ìˆ˜ì •</button>
            <button type="button" onclick="deleteAccount()" class="btn btn-danger">íƒˆí‡´</button>
          </form>
        </div>
      </div>
    </div>
  </div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbw5Dz9S6Fkam6b6_ZtjMUY3L3be0D_QUt-X_Id83uCCPy-NZyl97itlrrk27IYsltr-IQ/exec"; // Apps Script ë°°í¬ URL

  let currentUser = null;

  function showAlert(message, type='success') {
    const alertDiv = document.getElementById('alertDiv');
    alertDiv.innerHTML = `<div class="alert alert-${type==='success'?'success':'error'}">${message}</div>`;
    setTimeout(()=>alertDiv.innerHTML='',5000);
  }
  function showTab(tab) {
    document.querySelectorAll('#guestSection .tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('#guestSection > div:not(.tabs)').forEach(div=>div.classList.add('hidden'));
    event.target.classList.add('active');
    document.getElementById(tab+'Tab').classList.remove('hidden');
  }
  function showUserTab(tab) {
    document.querySelectorAll('#userSection .tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('#userSection > div:not(.tabs):not(:first-child)').forEach(div=>div.classList.add('hidden'));
    event.target.classList.add('active');
    document.getElementById(tab+'Tab').classList.remove('hidden');
  }
  async function callAPI(data){
    try{
      const res = await fetch(API_URL,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(data)
      });
      return await res.json();
    }catch(err){
      showAlert("ì„œë²„ì™€ ì—°ê²° ì˜¤ë¥˜",'error');
      throw err;
    }
  }
  // íšŒì› ë“±ë¡
  document.getElementById("registerForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const jobs=[...document.querySelectorAll("#registerForm input[type=checkbox]:checked")].map(c=>c.value)
      .filter(v=>["ê¸°ì","ì‹œì‚¬êµì–‘PD","ì˜ˆëŠ¥PD","ë“œë¼ë§ˆPD"].includes(v));
    const stages=[...document.querySelectorAll("#registerForm input[type=checkbox]:checked")].map(c=>c.value)
      .filter(v=>["ìŠ¤í„°ë””ì´ˆë³´ì","ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬","ì¸í„°ë·°ì¤‘ì‹¬","ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ"].includes(v));
    const body={
      action:"register",
      studentId:studentId.value,
      password:password.value,
      name:name.value,
      email:email.value,
      phone:phone.value,
      major:major.value,
      jobs, stages,
      message:message.value
    };
    const data=await callAPI(body);
    if(data.status==="success"){
      showAlert("ë“±ë¡ ì„±ê³µ! ë¡œê·¸ì¸í•˜ì„¸ìš”","success");
      showTab('login');
    }else showAlert(data.message,"error");
  });
  // ë¡œê·¸ì¸
  document.getElementById("loginForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const body={action:"login",studentId:loginStudentId.value,password:loginPassword.value};
    const data=await callAPI(body);
    if(data.status==="success"){
      currentUser=data.user;
      userName.textContent=currentUser.name;
      guestSection.classList.add("hidden");
      userSection.classList.remove("hidden");
      loadUserDataToUpdateForm();
    } else showAlert(data.message,"error");
  });
  function loadUserDataToUpdateForm(){
    updateMajor.value=currentUser.major||"";
    document.querySelectorAll("#updateJobs input").forEach(cb=>cb.checked=(currentUser.jobs||"").split(",").includes(cb.value));
    document.querySelectorAll("#updateStages input").forEach(cb=>cb.checked=(currentUser.stages||"").split(",").includes(cb.value));
    updateMessage.value=currentUser.message||"";
  }
  async function search(){
    const body={action:"search",job:searchJob.value,stage:searchStage.value,currentUser:currentUser.studentId};
    const data=await callAPI(body);
    const results=document.getElementById("results");
    if(data.status==="success"){
      if(data.students.length===0){
        results.innerHTML="<div class='notice'>ì¡°ê±´ì— ë§ëŠ” ìŠ¤í„°ë””ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
      } else {
        results.innerHTML=data.students.map(s=>`
          <div class="user-card">
            <h4>${s.name} (${s.studentId})</h4>
            <p><strong>ì „ê³µ:</strong> ${s.major||'ë¯¸ì…ë ¥'}</p>
            <p><strong>ì´ë©”ì¼:</strong> ${s.email}</p>
            <p><strong>ì—°ë½ì²˜:</strong> ${s.phone||'ë¯¸ì…ë ¥'}</p>
            <p><strong>í¬ë§ì§ì¢…:</strong> ${s.jobs||'ë¯¸ì„ íƒ'}</p>
            <p><strong>ìŠ¤í„°ë””ë‹¨ê³„:</strong> ${s.stages||'ë¯¸ì„ íƒ'}</p>
            <p><strong>ë‚¨ê¸´ ê¸€:</strong> ${s.message||'ì—†ìŒ'}</p>
          </div>`).join("");
      }
      results.classList.remove("hidden");
    } else showAlert(data.message,"error");
  }
  document.getElementById("updateForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const jobs=[...document.querySelectorAll("#updateJobs input:checked")].map(c=>c.value);
    const stages=[...document.querySelectorAll("#updateStages input:checked")].map(c=>c.value);
    const body={action:"update",studentId:currentUser.studentId,major:updateMajor.value,jobs,stages,message:updateMessage.value};
    const data=await callAPI(body);
    if(data.status==="success"){
      showAlert(data.message,"success");
      currentUser.major=updateMajor.value;
      currentUser.jobs=jobs.join(",");
      currentUser.stages=stages.join(",");
      currentUser.message=updateMessage.value;
    } else showAlert(data.message,"error");
  });
  async function deleteAccount(){
    if(!confirm("ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    const data=await callAPI({action:"delete",studentId:currentUser.studentId});
    if(data.status==="success"){ showAlert("íƒˆí‡´ ì™„ë£Œ","success"); logout(); }
    else showAlert(data.message,"error");
  }
  function logout(){
    currentUser=null;
    guestSection.classList.remove("hidden");
    userSection.classList.add("hidden");
    loginForm.reset();
    results.classList.add("hidden");
    showAlert("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤","success");
  }
</script>
</body>
</html>
               
