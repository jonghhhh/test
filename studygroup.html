<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì–¸ë¡ ì‚¬ ì·¨ì—… ìŠ¤í„°ë”” ë§¤ì¹­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 5px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            transform: scale(1.2);
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
        }

        .btn-success:hover {
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .search-controls {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .results {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e1e8ed;
        }

        .user-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }

        .notice {
            background: #fff3cd;
            color: #856404;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            border: 1px solid #ffeaa7;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hidden {
            display: none !important;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e1e8ed;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .tab:hover {
            color: #3498db;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        @media (max-width: 600px) {
            .search-controls {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“° ì–¸ë¡ ì‚¬ ì·¨ì—… ìŠ¤í„°ë”” ë§¤ì¹­</h1>
            <p>ì–¸ë¡ ì‚¬ ì·¨ì—…ì„ ì¤€ë¹„í•˜ëŠ” í•™ìƒë“¤ì„ ìœ„í•œ ìŠ¤í„°ë”” êµ¬ì„± í”Œë«í¼</p>
        </div>
        
        <div class="content">
            <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
            <div id="alertDiv"></div>

            <!-- ë¡œë”© í‘œì‹œ -->
            <div id="loading" class="loading">
                <p>ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>

            <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœ -->
            <div id="guestSection">
                <div class="tabs">
                    <button class="tab active" onclick="showTab('register')">íšŒì› ë“±ë¡</button>
                    <button class="tab" onclick="showTab('login')">ë¡œê·¸ì¸</button>
                </div>

                <!-- íšŒì› ë“±ë¡ -->
                <div id="registerTab" class="section">
                    <h2>ğŸ“ íšŒì› ë“±ë¡</h2>
                    <div class="notice">
                        ì–¸ë¡ ì‚¬ ì·¨ì—… ìŠ¤í„°ë””ë¥¼ í¬ë§í•˜ëŠ” í•™ìƒë“¤ì˜ ê¸°ì´ˆì •ë³´ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.<br>
                        <strong>í•™ë²ˆ, ë¹„ë°€ë²ˆí˜¸, ì´ë¦„, ì´ë©”ì¼</strong>ì€ í•„ìˆ˜ ì…ë ¥ì‚¬í•­ì…ë‹ˆë‹¤.<br>
                        <strong>ë“±ë¡ í›„ ë¡œê·¸ì¸í•˜ì—¬ ë‹¤ë¥¸ í•™ìƒ ê²€ìƒ‰ ë° ì •ë³´ ë³€ê²½ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</strong>
                    </div>
                    
                    <form id="registerForm">
                        <div class="form-group">
                            <label>í•™ë²ˆ *</label>
                            <input type="text" id="studentId" required>
                        </div>
                        
                        <div class="form-group">
                            <label>ë¹„ë°€ë²ˆí˜¸ *</label>
                            <input type="password" id="password" required>
                        </div>
                        
                        <div class="form-group">
                            <label>ì´ë¦„ *</label>
                            <input type="text" id="name" required>
                        </div>
                        
                        <div class="form-group">
                            <label>ì´ë©”ì¼ *</label>
                            <input type="email" id="email" required>
                        </div>
                        
                        <div class="form-group">
                            <label>íœ´ëŒ€í° (ì„ íƒ)</label>
                            <input type="text" id="phone">
                        </div>
                        
                        <div class="form-group">
                            <label>í¬ë§ ì§ì¢… (ì„ íƒ)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ê¸°ì" id="job1">
                                    <label for="job1">ê¸°ì</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ì‹œì‚¬êµì–‘PD" id="job2">
                                    <label for="job2">ì‹œì‚¬êµì–‘PD</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ì˜ˆëŠ¥PD" id="job3">
                                    <label for="job3">ì˜ˆëŠ¥PD</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ë“œë¼ë§ˆPD" id="job4">
                                    <label for="job4">ë“œë¼ë§ˆPD</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ìŠ¤í„°ë”” ë‹¨ê³„ (ì„ íƒ)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ìŠ¤í„°ë””ì´ˆë³´ì" id="stage1">
                                    <label for="stage1">ìŠ¤í„°ë””ì´ˆë³´ì</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬" id="stage2">
                                    <label for="stage2">ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ì¸í„°ë·°ì¤‘ì‹¬" id="stage3">
                                    <label for="stage3">ì¸í„°ë·°ì¤‘ì‹¬</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ" id="stage4">
                                    <label for="stage4">ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ë‚¨ê¸°ê³  ì‹¶ì€ ê¸€ (ì„ íƒ)</label>
                            <textarea id="message" placeholder="ìŠ¤í„°ë””ì›ë“¤ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§ì´ë‚˜ ë³¸ì¸ ì†Œê°œë¥¼ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
                        </div>
                        
                        <button type="submit" class="btn">ë“±ë¡í•˜ê¸°</button>
                    </form>
                </div>

                <!-- ë¡œê·¸ì¸ -->
                <div id="loginTab" class="section hidden">
                    <h2>ğŸ” ë¡œê·¸ì¸</h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label>í•™ë²ˆ</label>
                            <input type="text" id="loginStudentId" required>
                        </div>
                        
                        <div class="form-group">
                            <label>ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        
                        <button type="submit" class="btn">ë¡œê·¸ì¸</button>
                    </form>
                </div>
            </div>

            <!-- ë¡œê·¸ì¸í•œ ìƒíƒœ -->
            <div id="userSection" class="hidden">
                <div class="section" style="background: #e8f5e8;">
                    <h2>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, <span id="userName"></span>ë‹˜!</h2>
                    <button onclick="logout()" class="btn" style="float: right;">ë¡œê·¸ì•„ì›ƒ</button>
                    <div style="clear: both;"></div>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="showUserTab('search')">ìŠ¤í„°ë””ì› ê²€ìƒ‰</button>
                    <button class="tab" onclick="showUserTab('update')">ì •ë³´ ìˆ˜ì •</button>
                </div>

                <!-- ê²€ìƒ‰ -->
                <div id="searchTab" class="section">
                    <h2>ğŸ” ìŠ¤í„°ë””ì› ê²€ìƒ‰</h2>
                    <div class="notice">
                        í¬ë§í•˜ëŠ” ì§ì¢…ê³¼ ë‹¨ê³„ë¥¼ ì„ íƒí•˜ì—¬ í•¨ê»˜í•  ìŠ¤í„°ë””ì›ì„ ì°¾ì•„ë³´ì„¸ìš”.<br>
                        <strong>ê¸°ì´ˆì •ë³´ë¥¼ ë“±ë¡í•œ í•™ìƒë“¤ë§Œ ë¡œê·¸ì¸ í›„ ê²€ìƒ‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</strong>
                    </div>
                    
                    <div class="search-controls">
                        <div class="form-group">
                            <label>í¬ë§ ì§ì¢…</label>
                            <select id="searchJob">
                                <option value="ê¸°ì">ê¸°ì</option>
                                <option value="ì‹œì‚¬êµì–‘PD">ì‹œì‚¬êµì–‘PD</option>
                                <option value="ì˜ˆëŠ¥PD">ì˜ˆëŠ¥PD</option>
                                <option value="ë“œë¼ë§ˆPD">ë“œë¼ë§ˆPD</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>ìŠ¤í„°ë”” ë‹¨ê³„</label>
                            <select id="searchStage">
                                <option value="ìŠ¤í„°ë””ì´ˆë³´ì">ìŠ¤í„°ë””ì´ˆë³´ì</option>
                                <option value="ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬">ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬</option>
                                <option value="ì¸í„°ë·°ì¤‘ì‹¬">ì¸í„°ë·°ì¤‘ì‹¬</option>
                                <option value="ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ">ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ</option>
                            </select>
                        </div>
                        
                        <button onclick="search()" class="btn">ê²€ìƒ‰</button>
                    </div>
                    
                    <div id="results" class="results hidden"></div>
                </div>

                <!-- ì •ë³´ ìˆ˜ì • -->
                <div id="updateTab" class="section hidden">
                    <h2>âœï¸ ì •ë³´ ìˆ˜ì • ë° íƒˆí‡´</h2>
                    <div class="notice">
                        ì§ì¢… ë³€í™”ë‚˜ ìŠ¤í„°ë”” êµ¬ì„± ì™„ë£Œ ë“± ìƒí™© ë³€í™”ê°€ ìˆì„ ê²½ìš° ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                        <strong>ë¡œê·¸ì¸ í›„ì—ë§Œ ì •ë³´ ìˆ˜ì • ë° íƒˆí‡´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</strong>
                    </div>
                    
                    <form id="updateForm">
                        <div class="form-group">
                            <label>í¬ë§ ì§ì¢…</label>
                            <div class="checkbox-group" id="updateJobs">
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ê¸°ì" id="updateJob1">
                                    <label for="updateJob1">ê¸°ì</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ì‹œì‚¬êµì–‘PD" id="updateJob2">
                                    <label for="updateJob2">ì‹œì‚¬êµì–‘PD</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ì˜ˆëŠ¥PD" id="updateJob3">
                                    <label for="updateJob3">ì˜ˆëŠ¥PD</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ë“œë¼ë§ˆPD" id="updateJob4">
                                    <label for="updateJob4">ë“œë¼ë§ˆPD</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ìŠ¤í„°ë”” ë‹¨ê³„</label>
                            <div class="checkbox-group" id="updateStages">
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ìŠ¤í„°ë””ì´ˆë³´ì" id="updateStage1">
                                    <label for="updateStage1">ìŠ¤í„°ë””ì´ˆë³´ì</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬" id="updateStage2">
                                    <label for="updateStage2">ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ì¸í„°ë·°ì¤‘ì‹¬" id="updateStage3">
                                    <label for="updateStage3">ì¸í„°ë·°ì¤‘ì‹¬</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" value="ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ" id="updateStage4">
                                    <label for="updateStage4">ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ë‚¨ê¸°ê³  ì‹¶ì€ ê¸€</label>
                            <textarea id="updateMessage" placeholder="ìŠ¤í„°ë””ì›ë“¤ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§ì´ë‚˜ ë³¸ì¸ ì†Œê°œë¥¼ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-success">ì •ë³´ ìˆ˜ì •</button>
                        <button type="button" onclick="deleteAccount()" class="btn btn-danger" style="margin-left: 10px;">íƒˆí‡´í•˜ê¸°</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Apps Script ì›¹ì•± URL (ì‹¤ì œ ë°°í¬ëœ URLë¡œ ë³€ê²½)
        const API_URL = "https://script.google.com/macros/s/AKfycbzZp-YMz-eClAojjYiBfjmvBSLtIYWcaSoBB0ju3CUXZhvmyggbtrjFZO1rg4AMihdi0g/exec";
        
        let currentUser = null;

        // ë¡œë”© í‘œì‹œ í•¨ìˆ˜
        function showLoading(show = true) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
        function showAlert(message, type = 'success') {
            const alertDiv = document.getElementById('alertDiv');
            alertDiv.innerHTML = `<div class="alert alert-${type === 'success' ? 'success' : 'error'}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 5000);
        }

        // íƒ­ ì „í™˜ (ë¹„íšŒì›)
        function showTab(tabName) {
            document.querySelectorAll('#guestSection .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#guestSection > div:not(.tabs)').forEach(div => {
                div.classList.add('hidden');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
        }

        // íƒ­ ì „í™˜ (íšŒì›)
        function showUserTab(tabName) {
            document.querySelectorAll('#userSection .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#userSection > div:not(.tabs):not(:first-child)').forEach(div => {
                div.classList.add('hidden');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
        }

        // API í˜¸ì¶œ í•¨ìˆ˜ (CORS ëŒ€ì‘)
        async function callAPI(data) {
            showLoading(true);
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                showLoading(false);
                return result;
            } catch (error) {
                showLoading(false);
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                throw new Error('ì„œë²„ì™€ ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // íšŒì› ë“±ë¡
        document.getElementById("registerForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const jobs = [...document.querySelectorAll("#registerForm input[type=checkbox]:checked")]
                        .filter(c => ["ê¸°ì","ì‹œì‚¬êµì–‘PD","ì˜ˆëŠ¥PD","ë“œë¼ë§ˆPD"].includes(c.value))
                        .map(c => c.value);
            
            const stages = [...document.querySelectorAll("#registerForm input[type=checkbox]:checked")]
                        .filter(c => ["ìŠ¤í„°ë””ì´ˆë³´ì","ìŠ¤í„°ë””ê²½í—˜ìì¤‘ì‹¬","ì¸í„°ë·°ì¤‘ì‹¬","ìŠ¤í„°ë””êµ¬ì„±ì™„ë£Œ"].includes(c.value))
                        .map(c => c.value);

            const body = {
                action: "register",
                studentId: document.getElementById("studentId").value,
                password: document.getElementById("password").value,
                name: document.getElementById("name").value,
                email: document.getElementById("email").value,
                phone: document.getElementById("phone").value,
                jobs: jobs,
                stages: stages,
                message: document.getElementById("message").value
            };

            try {
                const data = await callAPI(body);
                
                if (data.status === "success") {
                    showAlert(data.message, 'success');
                    document.getElementById("registerForm").reset();
                    // ë“±ë¡ ì„±ê³µ ì‹œ ë¡œê·¸ì¸ íƒ­ìœ¼ë¡œ ì´ë™
                    setTimeout(() => {
                        showTab('login');
                        showAlert("ì´ì œ ë¡œê·¸ì¸í•˜ì—¬ ìŠ¤í„°ë””ì›ì„ ì°¾ì•„ë³´ì„¸ìš”!", 'success');
                    }, 1500);
                } else {
                    showAlert(data.message, 'error');
                }
            } catch (error) {
                showAlert(error.message, 'error');
            }
        });

        // ë¡œê·¸ì¸
        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const body = {
                action: "login",
                studentId: document.getElementById("loginStudentId").value,
                password: document.getElementById("loginPassword").value
            };

            try {
                const data = await callAPI(body);
                
                if (data.status === "success") {
                    currentUser = data.user;
                    document.getElementById("userName").textContent = currentUser.name;
                    document.getElementById("guestSection").classList.add("hidden");
                    document.getElementById("userSection").classList.remove("hidden");
                    
                    // ê¸°ì¡´ ì •ë³´ë¡œ ìˆ˜ì • í¼ ì±„ìš°ê¸°
                    loadUserDataToUpdateForm();
                    showAlert(`${data.user.name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`, 'success');
                } else {
                    showAlert(data.message, 'error');
                }
            } catch (error) {
                showAlert(error.message, 'error');
            }
        });

        // ì‚¬ìš©ì ë°ì´í„°ë¥¼ ìˆ˜ì • í¼ì— ë¡œë“œ
        function loadUserDataToUpdateForm() {
            const jobs = currentUser.jobs ? currentUser.jobs.split(",") : [];
            const stages = currentUser.stages ? currentUser.stages.split(",") : [];
            
            // ì§ì¢… ì²´í¬ë°•ìŠ¤ ì„¤ì •
            document.querySelectorAll("#updateJobs input[type=checkbox]").forEach(checkbox => {
                checkbox.checked = jobs.includes(checkbox.value);
            });
            
            // ë‹¨ê³„ ì²´í¬ë°•ìŠ¤ ì„¤ì •
            document.querySelectorAll("#updateStages input[type=checkbox]").forEach(checkbox => {
                checkbox.checked = stages.includes(checkbox.value);
            });
            
            // ë©”ì‹œì§€ ì„¤ì •
            document.getElementById("updateMessage").value = currentUser.message || "";
        }

        // ê²€ìƒ‰ í•¨ìˆ˜
        async function search() {
            const body = {
                action: "search",
                job: document.getElementById("searchJob").value,
                stage: document.getElementById("searchStage").value,
                currentUser: currentUser.studentId
            };

            try {
                const data = await callAPI(body);
                
                if (data.status === "success") {
                    const resultsDiv = document.getElementById("results");
                    if (data.students.length === 0) {
                        resultsDiv.innerHTML = '<div class="notice">ì¡°ê±´ì— ë§ëŠ” ìŠ¤í„°ë””ì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                    } else {
                        resultsDiv.innerHTML = data.students.map(student => `
                            <div class="user-card">
                                <h4>${student.name} (${student.studentId})</h4>
                                <p><strong>ì´ë©”ì¼:</strong> ${student.email}</p>
                                <p><strong>ì—°ë½ì²˜:</strong> ${student.phone || 'ë¯¸ì…ë ¥'}</p>
                                <p><strong>í¬ë§ì§ì¢…:</strong> ${student.jobs || 'ë¯¸ì„ íƒ'}</p>
                                <p><strong>ìŠ¤í„°ë””ë‹¨ê³„:</strong> ${student.stages || 'ë¯¸ì„ íƒ'}</p>
                                <p><strong>ë‚¨ê¸´ ê¸€:</strong> ${student.message || 'ì—†ìŒ'}</p>
                            </div>
                        `).join("");
                    }
                    resultsDiv.classList.remove("hidden");
                } else {
                    showAlert(data.message, 'error');
                }
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // ì •ë³´ ìˆ˜ì •
        document.getElementById("updateForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            
            const jobs = [...document.querySelectorAll("#updateJobs input[type=checkbox]:checked")]
                        .map(c => c.value);
            
            const stages = [...document.querySelectorAll("#updateStages input[type=checkbox]:checked")]
                        .map(c => c.value);

            const body = {
                action: "update",
                studentId: currentUser.studentId,
                jobs: jobs,
                stages: stages,
                message: document.getElementById("updateMessage").value
            };

            try {
                const data = await callAPI(body);
                
                if (data.status === "success") {
                    showAlert(data.message, 'success');
                    // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
                    currentUser.jobs = jobs.join(",");
                    currentUser.stages = stages.join(",");
                    currentUser.message = document.getElementById("updateMessage").value;
                } else {
                    showAlert(data.message, 'error');
                }
            } catch (error) {
                showAlert(error.message, 'error');
            }
        });

        // íƒˆí‡´
        async function deleteAccount() {
            if (!confirm("ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
                return;
            }

            const body = {
                action: "delete",
                studentId: currentUser.studentId
            };

            try {
                const data = await callAPI(body);
                
                if (data.status === "success") {
                    showAlert(data.message, 'success');
                    setTimeout(() => {
                        logout();
                    }, 2000);
                } else {
                    showAlert(data.message, 'error');
                }
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            currentUser = null;
            document.getElementById("guestSection").classList.remove("hidden");
            document.getElementById("userSection").classList.add("hidden");
            document.getElementById("loginForm").reset();
            document.getElementById("results").classList.add("hidden");
            showAlert("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.", 'success');
        }
    </script>
</body>
</html>                       
